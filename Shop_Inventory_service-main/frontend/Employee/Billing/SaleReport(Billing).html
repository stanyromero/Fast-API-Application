<!DOCTYPE html>
<html>
<head>
  <title>Sale Report (Billing)</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
        <div class="container">
          <h1>Sale Report (Billing)</h1>
              <label for="customerName">Customer Name:</label>
              <input type="text" id="customerName" placeholder="Enter customer name">
          
              <label for="phoneNumber">Phone Number:</label>
              <input type="text" id="phoneNumber" placeholder="Enter phone number">
          
              <h2>Items Purchased:</h2>
              <div id="itemList"></div>
          
              <label for="itemId">Item ID:</label>
              <input type="text" id="itemId" placeholder="Enter item ID">
          
              <label for="quantity">Quantity:</label>
              <input type="number" id="quantity" placeholder="Enter quantity">
          
              <button type="button" id="addItem" onclick="addItem(event)">Add Item</button>
              <button class="submit-button" onclick="submitSale()">Submit Sale</button>
      </div>

      <a href="../itemsList.html">Go to Items List</a>
      <a href="../Customer&SaleRepot.html">Go to Customer and Sale Details</a>


      <script>
        let itemsPurchased = [];
      
        function addItem() {
          const itemId = document.getElementById('itemId').value;
          const quantity = document.getElementById('quantity').value;
      
          if (itemId.trim() !== '' && quantity !== '' && parseInt(quantity) > 0) {
            // Since 'customer_id' and 'sale_id' are not provided by the user, set them to 0 for now.
            const newItem = {
              customer_id: 0,     // Replace 0 with the actual customer_id if known or generated by the backend
              item_id: itemId,
              quantity: parseInt(quantity)
            };
    
            itemsPurchased.push(newItem);
            document.getElementById('itemId').value = '';
            document.getElementById('quantity').value = '';
            displayItems();
          }
        }
      
        function displayItems() {
          const itemListDiv = document.getElementById('itemList');
          itemListDiv.innerHTML = '';
      
          itemsPurchased.forEach((item, index) => {
            const itemRow = document.createElement('div');
            itemRow.classList.add('item-row');
            itemRow.innerHTML = `
              <span>Item ID: ${item.item_id}</span>
              <span>Quantity: ${item.quantity}</span>
              <button onclick="removeItem(${index})">Remove</button>
            `;
            itemListDiv.appendChild(itemRow);
          });
        }
      
        function removeItem(index) {
          itemsPurchased.splice(index, 1);
          displayItems();
        }
      
        async function submitSale() {
          const customerName = document.getElementById('customerName').value;
          const phoneNumber = document.getElementById('phoneNumber').value;
      
          // Prepare the data to be sent to the API
          const sales = itemsPurchased.map(item => {
                return {
                    sale_id: 0,
                    customer_id: 0,
                    item_id: item.item_id,
                    quantity: item.quantity
                };
            });

            const saleData = {
                customer: {
                    customer_id: 0,
                    customer_name: customerName,
                    phone_number: phoneNumber
                },
                sales: sales
            };
      
          try {
            const response = await fetch('http://localhost:8000/sales/report/creation', { // Update the URL to your backend server
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(saleData)
            });
      
            if (response.ok) {
              alert('Sale report submitted successfully!');
              // Clearing the form and itemsPurchased array after successful submission
              document.getElementById('customerName').value = '';
              document.getElementById('phoneNumber').value = '';
              itemsPurchased = [];
              displayItems();
            } else {
              alert('Error submitting sale report. Please try again.');
            }
          } catch (error) {
            alert('Error submitting sale report. Please try again.');
            console.error('Error:', error);
          }
        }
      </script>
</body>
</html>
